<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conway's Game of Life - Scratch</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .controls {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      background: #222;
      display: flex;
      gap: 8px;
      justify-content: center;
      align-items: center;
      padding: 6px 0;
      z-index: 10;
    }
    button, select {
      padding: 3px 10px;
      font-size: 1rem;
      border-radius: 4px;
      border: none;
      background: #444;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover, select:hover {
      background: #666;
    }
    #gol-canvas {
      display: block;
      position: absolute;
      top: 40px;
      left: 0;
      width: 100vw;
      height: calc(100vh - 40px);
      background: #222;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <button id="random">Randomize</button>
    <button id="clear">Clear</button>
    <label>Speed:
      <select id="speed">
        <option value="60">Fast</option>
        <option value="30">Medium</option>
        <option value="10">Slow</option>
      </select>
    </label>
  </div>
  <canvas id="gol-canvas"></canvas>
  <script>
    const canvas = document.getElementById('gol-canvas');
    const ctx = canvas.getContext('2d');
    let cellSize = 18;
    let cols = 0, rows = 0;
    let grid = [];
    let running = false;
    let interval = null;
    let speed = 60;

    function resizeCanvas() {
      const controlsHeight = document.querySelector('.controls').offsetHeight;
      const w = window.innerWidth;
      const h = window.innerHeight - controlsHeight;
      canvas.width = w;
      canvas.height = h;
      cellSize = Math.max(10, Math.floor(Math.min(w, h) / 40));
      cols = Math.floor(w / cellSize);
      rows = Math.floor(h / cellSize);
      if (!Array.isArray(grid) || grid.length !== rows || (grid[0] && grid[0].length !== cols)) {
        grid = Array.from({length: rows}, () => Array.from({length: cols}, () => Math.random() > 0.8 ? 1 : 0));
      }
    }

    window.addEventListener('resize', () => {
      const prevGrid = grid;
      resizeCanvas();
      if (prevGrid && prevGrid.length && prevGrid[0].length) {
        for (let y = 0; y < Math.min(rows, prevGrid.length); y++) {
          for (let x = 0; x < Math.min(cols, prevGrid[0].length); x++) {
            grid[y][x] = prevGrid[y][x];
          }
        }
      }
      draw();
    });

    resizeCanvas();

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          if (grid[y][x]) {
            ctx.fillStyle = '#00e0ff';
            ctx.fillRect(x * cellSize, y * cellSize, cellSize-1, cellSize-1);
          }
        }
      }
    }

    function nextGen() {
      const newGrid = grid.map(arr => [...arr]);
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          let neighbors = 0;
          for (let dy = -1; dy <= 1; dy++) {
            for (let dx = -1; dx <= 1; dx++) {
              if (dx === 0 && dy === 0) continue;
              const ny = y + dy;
              const nx = x + dx;
              if (ny >= 0 && ny < rows && nx >= 0 && nx < cols) {
                neighbors += grid[ny][nx];
              }
            }
          }
          if (grid[y][x] && (neighbors < 2 || neighbors > 3)) newGrid[y][x] = 0;
          else if (!grid[y][x] && neighbors === 3) newGrid[y][x] = 1;
          else newGrid[y][x] = grid[y][x];
        }
      }
      grid = newGrid;
    }

    function loop() {
      if (!running) return;
      nextGen();
      draw();
      interval = setTimeout(loop, 1000 / speed);
    }

    document.getElementById('start').onclick = () => {
      if (!running) {
        running = true;
        loop();
      }
    };
    document.getElementById('stop').onclick = () => {
      running = false;
      clearTimeout(interval);
    };
    document.getElementById('random').onclick = () => {
      grid = Array.from({length: rows}, () => Array.from({length: cols}, () => Math.random() > 0.8 ? 1 : 0));
      draw();
    };
    document.getElementById('clear').onclick = () => {
      grid = Array.from({length: rows}, () => Array.from({length: cols}, () => 0));
      draw();
    };
    document.getElementById('speed').onchange = (e) => {
      speed = parseInt(e.target.value, 10);
    };

    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / cellSize);
      const y = Math.floor((e.clientY - rect.top) / cellSize);
      if (x >= 0 && x < cols && y >= 0 && y < rows) {
        grid[y][x] = grid[y][x] ? 0 : 1;
        draw();
      }
    });

    draw();
  </script>
</body>
</html>
